\hypertarget{classnfio_1_1Nfio}{\section{nfio.\-Nfio Class Reference}
\label{classnfio_1_1Nfio}\index{nfio.\-Nfio@{nfio.\-Nfio}}
}
Inheritance diagram for nfio.\-Nfio\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classnfio_1_1Nfio}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classnfio_1_1Nfio_a37d06beb4658927077f41fdfd237c2b1}{\-\_\-\-\_\-init\-\_\-\-\_\-}
\begin{DoxyCompactList}\small\item\em Instantiates a \hyperlink{classnfio_1_1Nfio}{Nfio} object. \end{DoxyCompactList}\item 
\hypertarget{classnfio_1_1Nfio_a73f04474e4c327027cc36e9a27d8d37d}{def {\bfseries access}}\label{classnfio_1_1Nfio_a73f04474e4c327027cc36e9a27d8d37d}

\item 
\hypertarget{classnfio_1_1Nfio_a0e1a2a60c6ad3552b9e737bf5c21b298}{def {\bfseries chmod}}\label{classnfio_1_1Nfio_a0e1a2a60c6ad3552b9e737bf5c21b298}

\item 
\hypertarget{classnfio_1_1Nfio_a69cc0d977007fc2057f167acfd484293}{def {\bfseries chown}}\label{classnfio_1_1Nfio_a69cc0d977007fc2057f167acfd484293}

\item 
def \hyperlink{classnfio_1_1Nfio_a46d186e9d92c1fea58a01ffc08ebb5dc}{getattr}
\begin{DoxyCompactList}\small\item\em Returns the file attributes of the file specified by path Args\-: path\-: Path of the file fh\-: Open file handle to the file Returns\-: A dictionary containing file attributes. \end{DoxyCompactList}\item 
\hypertarget{classnfio_1_1Nfio_a648947134659a41ad9b2b68d1aa7edfe}{def {\bfseries readdir}}\label{classnfio_1_1Nfio_a648947134659a41ad9b2b68d1aa7edfe}

\item 
\hypertarget{classnfio_1_1Nfio_a28f5eba4c82e6b5d7fb13654eb97cb8f}{def {\bfseries readlink}}\label{classnfio_1_1Nfio_a28f5eba4c82e6b5d7fb13654eb97cb8f}

\item 
\hypertarget{classnfio_1_1Nfio_ab34cbc64205b1932d86b6f79063710e4}{def {\bfseries mknod}}\label{classnfio_1_1Nfio_ab34cbc64205b1932d86b6f79063710e4}

\item 
\hypertarget{classnfio_1_1Nfio_afb377c76425223681e5aa703d75fc6ac}{def {\bfseries rmdir}}\label{classnfio_1_1Nfio_afb377c76425223681e5aa703d75fc6ac}

\item 
def \hyperlink{classnfio_1_1Nfio_a03f752db91f0335cf0f29d81bda84b66}{mkdir}
\begin{DoxyCompactList}\small\item\em The semantics have been redefined to create a new V\-N\-F instance when a directory is created under a specific type of V\-N\-F directory. \end{DoxyCompactList}\item 
\hypertarget{classnfio_1_1Nfio_a65835e246a89861440548951f75278a8}{def {\bfseries statfs}}\label{classnfio_1_1Nfio_a65835e246a89861440548951f75278a8}

\item 
\hypertarget{classnfio_1_1Nfio_a316c7dd77e736d1db3c4f1d4ce752b5e}{def {\bfseries unlink}}\label{classnfio_1_1Nfio_a316c7dd77e736d1db3c4f1d4ce752b5e}

\item 
\hypertarget{classnfio_1_1Nfio_a67a77270fc5247a10d9e170f7f554139}{def {\bfseries symlink}}\label{classnfio_1_1Nfio_a67a77270fc5247a10d9e170f7f554139}

\item 
\hypertarget{classnfio_1_1Nfio_aec88d98d0a363cda41f0df74fab80d23}{def {\bfseries rename}}\label{classnfio_1_1Nfio_aec88d98d0a363cda41f0df74fab80d23}

\item 
\hypertarget{classnfio_1_1Nfio_ad56e16263c502849dcb2a32d8d8d42de}{def {\bfseries link}}\label{classnfio_1_1Nfio_ad56e16263c502849dcb2a32d8d8d42de}

\item 
\hypertarget{classnfio_1_1Nfio_a4614e16989b90bd79c6610211ae1694b}{def {\bfseries utimens}}\label{classnfio_1_1Nfio_a4614e16989b90bd79c6610211ae1694b}

\item 
\hypertarget{classnfio_1_1Nfio_a7f8141a10d199e0c7d4da91727fb2767}{def {\bfseries open}}\label{classnfio_1_1Nfio_a7f8141a10d199e0c7d4da91727fb2767}

\item 
\hypertarget{classnfio_1_1Nfio_a157f53007ef2e2afb63ee80e84f52eff}{def {\bfseries create}}\label{classnfio_1_1Nfio_a157f53007ef2e2afb63ee80e84f52eff}

\item 
def \hyperlink{classnfio_1_1Nfio_aa96de630c8da283fe30851e8d7b378a3}{read}
\begin{DoxyCompactList}\small\item\em Reads an open file. \end{DoxyCompactList}\item 
def \hyperlink{classnfio_1_1Nfio_a05cc0184ab93ef65958275c46e322137}{write}
\begin{DoxyCompactList}\small\item\em Write to an open file. \end{DoxyCompactList}\item 
\hypertarget{classnfio_1_1Nfio_ae8802c658b4df260e1c630aa9856011c}{def {\bfseries truncate}}\label{classnfio_1_1Nfio_ae8802c658b4df260e1c630aa9856011c}

\item 
\hypertarget{classnfio_1_1Nfio_a11131bfcad8345d6caac6e8a0e9edf8e}{def {\bfseries flush}}\label{classnfio_1_1Nfio_a11131bfcad8345d6caac6e8a0e9edf8e}

\item 
\hypertarget{classnfio_1_1Nfio_aa8899667347dbe1c3176f25fa29a9621}{def {\bfseries release}}\label{classnfio_1_1Nfio_aa8899667347dbe1c3176f25fa29a9621}

\item 
\hypertarget{classnfio_1_1Nfio_a9839b74eb4091fcfaf5a7d35ad20ec25}{def {\bfseries fsync}}\label{classnfio_1_1Nfio_a9839b74eb4091fcfaf5a7d35ad20ec25}

\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classnfio_1_1Nfio_aaebb8f6c5190c41a25e5415c56a5e6dd}{{\bfseries root}}\label{classnfio_1_1Nfio_aaebb8f6c5190c41a25e5415c56a5e6dd}

\item 
\hypertarget{classnfio_1_1Nfio_a89d8c89f78cdec45abb64091de093e8b}{{\bfseries mountpoint}}\label{classnfio_1_1Nfio_a89d8c89f78cdec45abb64091de093e8b}

\item 
\hypertarget{classnfio_1_1Nfio_a6ec5f975fcf5378e65352c2f8b4e59d4}{{\bfseries hypervisor}}\label{classnfio_1_1Nfio_a6ec5f975fcf5378e65352c2f8b4e59d4}

\item 
\hypertarget{classnfio_1_1Nfio_a844cfc22cc19b0a22059d3f4adeb3a0e}{{\bfseries vnfs\-\_\-ops}}\label{classnfio_1_1Nfio_a844cfc22cc19b0a22059d3f4adeb3a0e}

\item 
\hypertarget{classnfio_1_1Nfio_a7f13fbcef42434fff50bbe6f3f301e83}{{\bfseries module\-\_\-root}}\label{classnfio_1_1Nfio_a7f13fbcef42434fff50bbe6f3f301e83}

\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 22 of file nfio.\-py.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classnfio_1_1Nfio_a37d06beb4658927077f41fdfd237c2b1}{\index{nfio\-::\-Nfio@{nfio\-::\-Nfio}!\-\_\-\-\_\-init\-\_\-\-\_\-@{\-\_\-\-\_\-init\-\_\-\-\_\-}}
\index{\-\_\-\-\_\-init\-\_\-\-\_\-@{\-\_\-\-\_\-init\-\_\-\-\_\-}!nfio::Nfio@{nfio\-::\-Nfio}}
\subsubsection[{\-\_\-\-\_\-init\-\_\-\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}def nfio.\-Nfio.\-\_\-\-\_\-init\-\_\-\-\_\- (
\begin{DoxyParamCaption}
\item[{}]{self, }
\item[{}]{root, }
\item[{}]{mountpoint, }
\item[{}]{hypervisor = {\ttfamily 'Docker'}, }
\item[{}]{module\-\_\-root = {\ttfamily 'middleboxes'}}
\end{DoxyParamCaption}
)}}\label{classnfio_1_1Nfio_a37d06beb4658927077f41fdfd237c2b1}


Instantiates a \hyperlink{classnfio_1_1Nfio}{Nfio} object. 

Args\-: root\-: The root directory of nfio file system. The root directory stores persistent state about the system. mountpoint\-: The mountpoint of nfio file system. The mountpoint is required to intercept the file system calls via fuse. All the file system calls for fuse mounted files/directories are intercepted by libfuse and our provided implementation is executed. hypervisor\-: The type of hypervisor to use for deploying V\-N\-Fs. The default is to use Docker containers. However, we also plan to add support for Libvirt. module\-\_\-root\-: Root directory of the middlebox modules. Each middlebox provides it's own implementation of certain system calls in a separate module. module\-\_\-root points to the root of that module. If nothing is provided a default of 'middleboxes' will be assumed. Returns\-: Nothing. Mounts nf.\-io file system at the specified mountpoint and creates a loop to act upon different file system calls. 

Definition at line 52 of file nfio.\-py.


\begin{DoxyCode}
52 
53             module\_root=\textcolor{stringliteral}{'middleboxes'}):
54         self.\hyperlink{classnfio_1_1Nfio_aaebb8f6c5190c41a25e5415c56a5e6dd}{root} = root
55         self.\hyperlink{classnfio_1_1Nfio_a89d8c89f78cdec45abb64091de093e8b}{mountpoint} = mountpoint
56         self.\hyperlink{classnfio_1_1Nfio_a6ec5f975fcf5378e65352c2f8b4e59d4}{hypervisor} = hypervisor
57         self.\hyperlink{classnfio_1_1Nfio_a844cfc22cc19b0a22059d3f4adeb3a0e}{vnfs\_ops} = \hyperlink{classvnfs__operations_1_1VNFSOperations}{VNFSOperations}(root)
58         self.\hyperlink{classnfio_1_1Nfio_a7f13fbcef42434fff50bbe6f3f301e83}{module\_root} = module\_root

\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{classnfio_1_1Nfio_a46d186e9d92c1fea58a01ffc08ebb5dc}{\index{nfio\-::\-Nfio@{nfio\-::\-Nfio}!getattr@{getattr}}
\index{getattr@{getattr}!nfio::Nfio@{nfio\-::\-Nfio}}
\subsubsection[{getattr}]{\setlength{\rightskip}{0pt plus 5cm}def nfio.\-Nfio.\-getattr (
\begin{DoxyParamCaption}
\item[{}]{self, }
\item[{}]{path, }
\item[{}]{fh = {\ttfamily None}}
\end{DoxyParamCaption}
)}}\label{classnfio_1_1Nfio_a46d186e9d92c1fea58a01ffc08ebb5dc}


Returns the file attributes of the file specified by path Args\-: path\-: Path of the file fh\-: Open file handle to the file Returns\-: A dictionary containing file attributes. 

The dictionary contains the following keys\-: st\-\_\-atime\-: Last access time st\-\_\-ctime\-: File creation time st\-\_\-gid\-: Group id of the owner group st\-\_\-mode\-: File access mode st\-\_\-mtime\-: Last modification time st\-\_\-nlink\-: Number of symbolic links to the file st\-\_\-size\-: Size of the file in bytes st\-\_\-uid\-: User id of the file owner Note\-: For special placeholder files for V\-N\-Fs, st\-\_\-size is set to a constant 1000. This is to make sure read utilities such as cat work for these special placeholder files. 

Definition at line 119 of file nfio.\-py.


\begin{DoxyCode}
119 
120     \textcolor{keyword}{def }\hyperlink{classnfio_1_1Nfio_a46d186e9d92c1fea58a01ffc08ebb5dc}{getattr}(self, path, fh=None):
121         opcode = self.vnfs\_ops.vnfs\_get\_opcode(path)
122         \textcolor{keywordflow}{if} opcode == VNFSOperations.OP\_NF:
123             nf\_type = self.vnfs\_ops.vnfs\_get\_nf\_type(path)
124             \textcolor{keywordflow}{if} len(nf\_type) > 0:
125                 \textcolor{keywordflow}{try}:
126                     mbox\_module = importlib.import\_module(
127                         self.\hyperlink{classnfio_1_1Nfio_a7f13fbcef42434fff50bbe6f3f301e83}{module\_root} +
128                         \textcolor{stringliteral}{"."} +
129                         nf\_type)
130                 \textcolor{keywordflow}{except} ImportError:
131                     logger.error(\textcolor{stringliteral}{'VNF module file missing. Add "'} + nf\_type 
132                         + \textcolor{stringliteral}{'.py" under the directory '} + self.\hyperlink{classnfio_1_1Nfio_a7f13fbcef42434fff50bbe6f3f301e83}{module\_root})
133                     \textcolor{comment}{## TODO: raise an custom exception and handle it in a OS }
134                     \textcolor{comment}{## specific way}
135                     \textcolor{keywordflow}{raise} OSError(errno.ENOSYS)
136                 \textcolor{keywordflow}{return} mbox\_module.\_getattr(self.\hyperlink{classnfio_1_1Nfio_aaebb8f6c5190c41a25e5415c56a5e6dd}{root}, path, fh)
137         full\_path = self.\hyperlink{classnfio_1_1Nfio_ab4c25ee90129e28ddc7c88ad113869de}{\_full\_path}(path)
138         st = os.lstat(full\_path)
139         file\_name = self.vnfs\_ops.vnfs\_get\_file\_name(full\_path)
140         \textcolor{keywordflow}{return} dict(
141             (key,
142              \hyperlink{classnfio_1_1Nfio_a46d186e9d92c1fea58a01ffc08ebb5dc}{getattr}(
143                  st,
144                  key)) \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} (
145                 \textcolor{stringliteral}{'st\_atime'},
146                 \textcolor{stringliteral}{'st\_ctime'},
147                 \textcolor{stringliteral}{'st\_gid'},
148                 \textcolor{stringliteral}{'st\_mode'},
149                 \textcolor{stringliteral}{'st\_mtime'},
150                 \textcolor{stringliteral}{'st\_nlink'},
151                 \textcolor{stringliteral}{'st\_size'},
152                 \textcolor{stringliteral}{'st\_uid'}))

\end{DoxyCode}
\hypertarget{classnfio_1_1Nfio_a03f752db91f0335cf0f29d81bda84b66}{\index{nfio\-::\-Nfio@{nfio\-::\-Nfio}!mkdir@{mkdir}}
\index{mkdir@{mkdir}!nfio::Nfio@{nfio\-::\-Nfio}}
\subsubsection[{mkdir}]{\setlength{\rightskip}{0pt plus 5cm}def nfio.\-Nfio.\-mkdir (
\begin{DoxyParamCaption}
\item[{}]{self, }
\item[{}]{path, }
\item[{}]{mode}
\end{DoxyParamCaption}
)}}\label{classnfio_1_1Nfio_a03f752db91f0335cf0f29d81bda84b66}


The semantics have been redefined to create a new V\-N\-F instance when a directory is created under a specific type of V\-N\-F directory. 

Args\-: path\-: path of the directory to create. The path also represents the name of the new V\-N\-F instance to be created. mode\-: File access mode for the new directory. Returns\-: If path does not correspond to a directory under a specific V\-N\-F type directory then errno.\-E\-P\-E\-R\-M is returned. Otherwise the return code is same as os.\-mkdir()'s return code. 

Definition at line 188 of file nfio.\-py.


\begin{DoxyCode}
188 
189     \textcolor{keyword}{def }\hyperlink{classnfio_1_1Nfio_a03f752db91f0335cf0f29d81bda84b66}{mkdir}(self, path, mode):
190         opcode = self.vnfs\_ops.vnfs\_get\_opcode(path)
191         \textcolor{keywordflow}{if} opcode == VNFSOperations.OP\_NF:
192             nf\_type = self.vnfs\_ops.vnfs\_get\_nf\_type(path)
193             \textcolor{comment}{# Check if this directory is an instance directory or a type}
194             \textcolor{comment}{# directory}
195             path\_tokens = path.split(\textcolor{stringliteral}{"/"})
196             \textcolor{keywordflow}{if} path\_tokens.index(\textcolor{stringliteral}{"nf-types"}) == len(path\_tokens) - 2:
197                 \textcolor{keywordflow}{return} os.mkdir(self.\hyperlink{classnfio_1_1Nfio_ab4c25ee90129e28ddc7c88ad113869de}{\_full\_path}(path), mode)
198             mbox\_module = importlib.import\_module(
199                 self.\hyperlink{classnfio_1_1Nfio_a7f13fbcef42434fff50bbe6f3f301e83}{module\_root} +
200                 \textcolor{stringliteral}{"."} +
201                 nf\_type)
202             result = mbox\_module.\_mkdir(self.\hyperlink{classnfio_1_1Nfio_aaebb8f6c5190c41a25e5415c56a5e6dd}{root}, path, mode)
203         \textcolor{keywordflow}{elif} opcode == VNFSOperations.OP\_UNDEFINED:
204             result = errno.EPERM
205         \textcolor{keywordflow}{return} result

\end{DoxyCode}
\hypertarget{classnfio_1_1Nfio_aa96de630c8da283fe30851e8d7b378a3}{\index{nfio\-::\-Nfio@{nfio\-::\-Nfio}!read@{read}}
\index{read@{read}!nfio::Nfio@{nfio\-::\-Nfio}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}def nfio.\-Nfio.\-read (
\begin{DoxyParamCaption}
\item[{}]{self, }
\item[{}]{path, }
\item[{}]{length, }
\item[{}]{offset, }
\item[{}]{fh}
\end{DoxyParamCaption}
)}}\label{classnfio_1_1Nfio_aa96de630c8da283fe30851e8d7b378a3}


Reads an open file. 

This nfio specific implementation parses path to see if the read is from any V\-N\-F or not. In case the read is from a V\-N\-F, the corresponding V\-N\-F module is loaded and the module's \-\_\-read function is invoked to complete the read system call.

Args\-: path\-: path represents the path of the file to read from length\-: number of bytes to read from the file offset\-: byte offset indicating the starting byte to read from fh\-: file descriptor of the open file represented by path

Returns\-: length bytes from offset byte of the file represented by fh and path

Notes\-: V\-N\-Fs can have special files which are placeholders for statistics such as number of received/sent bytes etc. V\-N\-Fs provide their own implementation of read and handle reading of these special placeholder files. 

Definition at line 273 of file nfio.\-py.


\begin{DoxyCode}
273 
274     \textcolor{keyword}{def }\hyperlink{classnfio_1_1Nfio_aa96de630c8da283fe30851e8d7b378a3}{read}(self, path, length, offset, fh):
275         full\_path = self.\hyperlink{classnfio_1_1Nfio_ab4c25ee90129e28ddc7c88ad113869de}{\_full\_path}(path)
276         opcode = self.vnfs\_ops.vnfs\_get\_opcode(full\_path)
277         file\_name = self.vnfs\_ops.vnfs\_get\_file\_name(full\_path)
278         \textcolor{keywordflow}{if} opcode == self.vnfs\_ops.OP\_NF:
279             nf\_type = self.vnfs\_ops.vnfs\_get\_nf\_type(path)
280             mbox\_module = importlib.import\_module(
281                 self.\hyperlink{classnfio_1_1Nfio_a7f13fbcef42434fff50bbe6f3f301e83}{module\_root} +
282                 \textcolor{stringliteral}{"."} +
283                 nf\_type)
284             \textcolor{keywordflow}{return} mbox\_module.\_read(self.\hyperlink{classnfio_1_1Nfio_aaebb8f6c5190c41a25e5415c56a5e6dd}{root}, path, length, offset, fh)
285         os.lseek(fh, offset, os.SEEK\_SET)
286         \textcolor{keywordflow}{return} os.read(fh, length)

\end{DoxyCode}
\hypertarget{classnfio_1_1Nfio_a05cc0184ab93ef65958275c46e322137}{\index{nfio\-::\-Nfio@{nfio\-::\-Nfio}!write@{write}}
\index{write@{write}!nfio::Nfio@{nfio\-::\-Nfio}}
\subsubsection[{write}]{\setlength{\rightskip}{0pt plus 5cm}def nfio.\-Nfio.\-write (
\begin{DoxyParamCaption}
\item[{}]{self, }
\item[{}]{path, }
\item[{}]{buf, }
\item[{}]{offset, }
\item[{}]{fh}
\end{DoxyParamCaption}
)}}\label{classnfio_1_1Nfio_a05cc0184ab93ef65958275c46e322137}


Write to an open file. 

In this nfio specific implementation the path is parsed to see if the write is for any specific V\-N\-F or not. If the write is for any file under a V\-N\-F directory then the corresponding V\-N\-F module is loaded and the module's \-\_\-write function is invoked.

Args\-: path\-: path to the file to write buf\-: the data to write offset\-: the byte offset at which the write should begin fh\-: file descriptor of the open file represented by path

Returns\-: Returns the number of bytes written to the file starting at offset

Note\-: V\-N\-Fs can have special files where writing specific strings trigger a specific function. For example, writing 'activate' to the 'action' file of a V\-N\-F will start the V\-N\-F. V\-N\-F specific modules handle such special cases of writing. 

Definition at line 309 of file nfio.\-py.


\begin{DoxyCode}
309 
310     \textcolor{keyword}{def }\hyperlink{classnfio_1_1Nfio_a05cc0184ab93ef65958275c46e322137}{write}(self, path, buf, offset, fh):
311         opcode = self.vnfs\_ops.vnfs\_get\_opcode(path)
312         full\_path = self.\hyperlink{classnfio_1_1Nfio_ab4c25ee90129e28ddc7c88ad113869de}{\_full\_path}(path)
313         file\_name = self.vnfs\_ops.vnfs\_get\_file\_name(path)
314         \textcolor{keywordflow}{if} opcode == VNFSOperations.OP\_NF:
315             nf\_type = self.vnfs\_ops.vnfs\_get\_nf\_type(full\_path)
316             mbox\_module = importlib.import\_module(
317                 self.\hyperlink{classnfio_1_1Nfio_a7f13fbcef42434fff50bbe6f3f301e83}{module\_root} +
318                 \textcolor{stringliteral}{"."} +
319                 nf\_type)
320             \textcolor{keywordflow}{return} mbox\_module.\_write(self.\hyperlink{classnfio_1_1Nfio_aaebb8f6c5190c41a25e5415c56a5e6dd}{root}, path, buf, offset, fh)
321 
322         os.lseek(fh, offset, os.SEEK\_SET)
323         \textcolor{keywordflow}{return} os.write(fh, buf)

\end{DoxyCode}


The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
Wat\-N\-F\-V/nf.\-io/src/nfio.\-py\end{DoxyCompactItemize}
